/* Copyright 2024 Securly, Inc. All rights reserved. */
var ytport=chrome.runtime.connect({name:"yt"});function onYTWindowLoad(){try{window.onscroll=function(){onWindowScroll()},window.youtubeLastCheck=null,sendOptionsRequest();let o=document.documentElement.innerHTML.indexOf("ytp-embed")>=0;if(o){let e=null,n=null,t=/\/watch\?v=([a-zA-Z0-9-_]{1,})">/,d=document.documentElement.innerHTML.match(t);d&&2==d.length&&(e=d[1]);let i=/\/channel\/([a-zA-Z0-9-_]{1,})"/;(d=document.documentElement.innerHTML.match(i))&&2==d.length&&(n=d[1]);let r={channelId:n=fetchChannelIdForEmbededVideo()||n,videoId:e,category:null,embedded:o};if(null!=r.channelId||null!=r.videoId)return sendYTData(r),!0}if(-1==document.documentElement.innerHTML.indexOf('window["ytInitialPlayerResponse"] = null')){sendYTData(fetchPageInfo(!0,document.documentElement.innerHTML))}if(document.documentElement.innerHTML.indexOf('id="channel-handle"')>-1){sendYTData(fetchPageInfo(!1))}var e=document.title.toString(),n=document.querySelector("title"),t=new MutationObserver(function(n){n.some(function(n){var t=n.target.textContent.toString();if((t=(t=t.replace(/^\([0-9]{0,}\)\s/,"")).replace(/ +/g," "))!=e)return e=t,document.URL.includes("music.youtube.com")||-1!=document.URL.indexOf("results?search_query")||location.reload(),!0})});if(n&&t.observe(n,{subtree:!0,characterData:!0,childList:!0}),null!=document.querySelector("ytd-browse"))window.ytdBrowse=document.querySelector("ytd-browse"),window.lastUpdateBrowse=null,new MutationObserver(function(e){e.some(function(){if(null==window.lastUpdateBrowse||Math.floor(Date.now()/1e3)-window.lastUpdateBrowse>5){return window.lastUpdateBrowse=Math.floor(Date.now()/1e3),sendYTData(fetchPageInfo(!1)),processActions(window.lastResponse),!0}})}).observe(ytdBrowse,{subtree:!0,characterData:!0,childList:!0})}catch(e){console.error("error while loading youtube source",e)}}function fetchChannelIdForEmbededVideo(){var e=document.getElementsByTagName("script");let n=null;for(var t=0;t<e.length;t++){var o=e[t].textContent||e[t].innerText;if(o.includes("channelId")){let e=o.indexOf("ytcfg.set(")+10,t=o.indexOf(");",e)-e;try{let d=JSON.parse(o.substr(e,t));n=JSON.parse(d.PLAYER_VARS.embedded_player_response).embedPreview.thumbnailPreviewRenderer.webPlayerActionsPorting.subscribeCommand.subscribeEndpoint.channelIds[0]}catch(e){console.error("Error while parsing and fetching channel id for embeded video",e)}}}return n}function fetchPageInfo(e,n=""){if(e){let e=n.indexOf("var ytInitialPlayerResponse = ")+30,i=n.indexOf("};",e)+1-e;var t=null,o=null,d=null;let r=n.indexOf("ytp-embed")>=0;if(!r)try{let r=JSON.parse(n.substr(e,i));t=r.videoDetails.channelId,o=r.videoDetails.videoId,d=r.microformat.playerMicroformatRenderer.category}catch(e){}return{channelId:t,videoId:o,category:d,embedded:r}}if(!1===e&&null!=document.querySelector("meta[itemprop='identifier']")){return{channelId:document.querySelector("meta[itemprop='identifier']").getAttribute("content"),videoId:null,category:null,embedded:n.indexOf("ytp-embed")>=0}}}function sendYTData(e){ytport.postMessage({url:document.URL,channelId:e.channelId,videoId:e.videoId,category:e.category,embedded:e.embedded,action:"getSourceYoutube"})}function sendOptionsRequest(){ytport.postMessage({action:"getYoutubeOptions"})}function processActions(e){window.lastResponse!=e&&(window.lastResponse=e),e.hideComments&&hideComment(),e.hideThumbnails&&hideThumbnails(),e.hideSidebar&&hideSidebar(),e.hideRecommended&&hideRecommended(),"deny"===e.action&&e.embedded&&document.location.href.includes("youtube.com/embed")&&(document.location.href=e.url)}function hideComment(){null!==document.querySelector("ytd-comments")&&document.querySelector("ytd-comments").remove()}function hideThumbnails(){[...document.querySelectorAll("ytd-thumbnail")].forEach(e=>{e.remove()}),[...document.querySelectorAll("ytd-playlist-thumbnail")].forEach(e=>{e.remove()})}function hideSidebar(){null!==document.querySelector("div[id='related']")&&document.querySelector("div[id='related']").remove()}function hideRecommended(){}function onWindowScroll(){processActions(window.lastResponse)}function callWindowLoadWithTimeOut(){setTimeout(onYTWindowLoad,2e3)}ytport.onMessage.addListener(function(e){processActions(e)}),window.lastResponse=null,window.youtubeLastCheck=null,window.addEventListener?window.addEventListener("load",callWindowLoadWithTimeOut,!1):window.attachEvent&&window.attachEvent("onload",callWindowLoadWithTimeOut);